# ğŸš€ Roadmap de Melhorias - Dashboard NutrIA

## ğŸ¯ PrÃ³ximas Features PrioritÃ¡rias

### 1. ğŸ’¬ Interface de Conversas Espelhadas (WhatsApp Web Style)

**Objetivo:** Ver e acompanhar conversas em tempo real, como se fosse WhatsApp Web

#### Design Proposto:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ Conversas                                    [ğŸ” Buscar] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              â”‚                                              â”‚
â”‚ ğŸŸ¢ Diego     â”‚  Diego Fernandes                    [ğŸ‘ï¸][ğŸ‰]â”‚
â”‚ hÃ¡ 2 min     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ 3 anÃ¡lises   â”‚                                              â”‚
â”‚              â”‚  ğŸ‘¤ Oi, esse whey Ã© bom?          21:30     â”‚
â”‚ ğŸŸ¡ Henry     â”‚                                              â”‚
â”‚ hÃ¡ 15 min    â”‚  ğŸ¤– Vou analisar o rÃ³tulo pra     21:30     â”‚
â”‚ 10 anÃ¡lises  â”‚     vocÃª! Manda a foto                      â”‚
â”‚              â”‚                                              â”‚
â”‚ âšª Ivan      â”‚  ğŸ‘¤ [ğŸ“· Imagem]                   21:31     â”‚
â”‚ hÃ¡ 2 dias    â”‚                                              â”‚
â”‚ 0 anÃ¡lises   â”‚  ğŸ¤– Analisando... â³              21:31     â”‚
â”‚              â”‚                                              â”‚
â”‚              â”‚  ğŸ¤– Score: 8.0/10 âœ…              21:32     â”‚
â”‚              â”‚     Whey 100% Pure                          â”‚
â”‚              â”‚     â€¢ ProteÃ­na: 24g âœ…                      â”‚
â”‚              â”‚     â€¢ Carboidratos: 2g âœ…                   â”‚
â”‚              â”‚     â€¢ Gordura: 1g âœ…                        â”‚
â”‚              â”‚                                              â”‚
â”‚              â”‚  ğŸ‘¤ Obrigado! ğŸ™                  21:33     â”‚
â”‚              â”‚                                              â”‚
â”‚              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚              â”‚  [Digite uma mensagem...]        [Enviar]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Features:

**Lista de Conversas (Esquerda):**
- âœ… UsuÃ¡rios ordenados por Ãºltima mensagem
- âœ… Status online/offline em tempo real
- âœ… Preview da Ãºltima mensagem
- âœ… Contador de mensagens nÃ£o lidas
- âœ… Badge de trial/premium
- âœ… Busca por nome/telefone

**Ãrea de Chat (Direita):**
- âœ… HistÃ³rico completo da conversa
- âœ… Mensagens do usuÃ¡rio (direita, azul)
- âœ… Mensagens do bot (esquerda, cinza)
- âœ… Timestamps
- âœ… Indicador de "digitando..."
- âœ… Preview de imagens enviadas
- âœ… AnÃ¡lises formatadas (cards)
- âœ… Scroll automÃ¡tico para nova mensagem

**AÃ§Ãµes RÃ¡pidas:**
- ğŸ“Œ Fixar conversa
- ğŸ”• Silenciar notificaÃ§Ãµes
- ğŸ‘ï¸ Ver perfil pÃºblico
- ğŸ‰ Ver wrapped
- ğŸ·ï¸ Adicionar tags
- ğŸ“ Adicionar notas internas

**Envio de Mensagens (Futuro):**
- âœï¸ Digitar e enviar mensagem
- ğŸ“ Anexar arquivo
- ğŸ˜Š Emojis
- ğŸ’¾ Templates de mensagem
- ğŸ¤– SugestÃµes da IA

#### ImplementaÃ§Ã£o:

**Backend:**
```javascript
// routes/conversations.js

// GET /api/conversations/list - Lista de conversas
router.get('/list', async (req, res) => {
  const conversations = await query(`
    SELECT DISTINCT ON (c.user_id)
      c.user_id,
      u.name,
      u.subscription,
      c.content as last_message,
      c.role as last_message_role,
      c.timestamp as last_message_time,
      u.last_interaction,
      COUNT(*) OVER (PARTITION BY c.user_id) as message_count
    FROM n8n_chat c
    JOIN users u ON c.user_id = u.id
    ORDER BY c.user_id, c.timestamp DESC
  `);
  res.json(conversations);
});

// GET /api/conversations/:userId - HistÃ³rico completo
router.get('/:userId', async (req, res) => {
  const messages = await query(`
    SELECT 
      id,
      role,
      content,
      timestamp,
      session_id
    FROM n8n_chat
    WHERE user_id = $1
    ORDER BY timestamp ASC
  `, [req.params.userId]);
  res.json(messages);
});

// WebSocket para mensagens em tempo real
wss.on('connection', (ws) => {
  ws.on('message', (data) => {
    const { type, userId } = JSON.parse(data);
    if (type === 'subscribe') {
      // Inscrever para receber mensagens deste usuÃ¡rio
      subscribeToUser(ws, userId);
    }
  });
});
```

**Frontend:**
```jsx
// pages/ConversationsLive.jsx
export default function ConversationsLive() {
  const [conversations, setConversations] = useState([]);
  const [selectedUser, setSelectedUser] = useState(null);
  const [messages, setMessages] = useState([]);
  const [ws, setWs] = useState(null);

  // Conectar WebSocket
  useEffect(() => {
    const websocket = new WebSocket('ws://...');
    websocket.onmessage = (event) => {
      const newMessage = JSON.parse(event.data);
      setMessages(prev => [...prev, newMessage]);
    };
    setWs(websocket);
  }, []);

  // Carregar conversas
  useEffect(() => {
    fetch('/api/conversations/list')
      .then(r => r.json())
      .then(setConversations);
  }, []);

  // Carregar mensagens do usuÃ¡rio selecionado
  useEffect(() => {
    if (selectedUser) {
      fetch(`/api/conversations/${selectedUser}`)
        .then(r => r.json())
        .then(setMessages);
      
      // Inscrever no WebSocket
      ws?.send(JSON.stringify({ 
        type: 'subscribe', 
        userId: selectedUser 
      }));
    }
  }, [selectedUser]);

  return (
    <div className="flex h-screen">
      {/* Lista de conversas */}
      <ConversationsList 
        conversations={conversations}
        selected={selectedUser}
        onSelect={setSelectedUser}
      />
      
      {/* Ãrea de chat */}
      <ChatArea 
        messages={messages}
        user={conversations.find(c => c.user_id === selectedUser)}
      />
    </div>
  );
}
```

---

### 2. ğŸ“¡ Feed de Eventos em Tempo Real

**Objetivo:** Ver tudo que estÃ¡ acontecendo no sistema em tempo real

#### Design Proposto:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¡ Eventos em Tempo Real                    [Filtros â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸŸ¢ AGORA â€¢ Diego Fernandes                                 â”‚
â”‚  ğŸ“Š Analisou produto: Whey 100% Pure                        â”‚
â”‚  Score: 8.0/10 âœ…                                           â”‚
â”‚  hÃ¡ 2 segundos                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ’¬ HÃ 1 MIN â€¢ Henry                                        â”‚
â”‚  Enviou mensagem: "Quantas calorias tem nisso?"             â”‚
â”‚  [Ver conversa]                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ‰ HÃ 5 MIN â€¢ Ivan Moniz                                   â”‚
â”‚  Completou 7 dias consecutivos! ğŸ”¥                          â”‚
â”‚  [Enviar parabÃ©ns]                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  HÃ 10 MIN â€¢ souliny                                    â”‚
â”‚  Inativo hÃ¡ 3 dias - Risco de churn                         â”‚
â”‚  [Enviar reengajamento]                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ’° HÃ 15 MIN â€¢ Diego Fernandes                             â”‚
â”‚  Atingiu limite de anÃ¡lises (3/3)                           â”‚
â”‚  [Oferecer upgrade]                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ“¸ HÃ 20 MIN â€¢ Henry                                       â”‚
â”‚  Enviou foto de rÃ³tulo                                      â”‚
â”‚  [Ver imagem]                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ‹ï¸ HÃ 30 MIN â€¢ Ivan Moniz                                 â”‚
â”‚  Registrou treino: Peito                                    â”‚
â”‚  DuraÃ§Ã£o: 45 min                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                              â”‚
â”‚  ğŸ”” HÃ 1 HORA â€¢ Sistema                                     â”‚
â”‚  2 trials acabam em 24h                                     â”‚
â”‚  [Ver usuÃ¡rios]                                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Tipos de Eventos:

**UsuÃ¡rio:**
- ğŸ’¬ Nova mensagem
- ğŸ“Š Nova anÃ¡lise
- ğŸ“¸ Foto enviada
- ğŸ‹ï¸ Treino registrado
- ğŸ½ï¸ RefeiÃ§Ã£o registrada
- ğŸ¯ Meta atingida
- ğŸ”¥ Streak mantido

**Sistema:**
- âš ï¸ UsuÃ¡rio inativo
- ğŸ’° Limite atingido
- ğŸ‰ Milestone alcanÃ§ado
- ğŸ”” Trial acabando
- âŒ Erro no bot
- âœ… Follow-up respondido

**ConversÃ£o:**
- ğŸ’³ Upgrade para premium
- ğŸ Trial iniciado
- ğŸ˜¢ Cancelamento
- ğŸ”„ RenovaÃ§Ã£o

#### Features:

**Filtros:**
- ğŸ“‹ Todos os eventos
- ğŸ’¬ Apenas conversas
- ğŸ“Š Apenas anÃ¡lises
- âš ï¸ Apenas alertas
- ğŸ‰ Apenas milestones
- ğŸ‘¤ Por usuÃ¡rio especÃ­fico

**AÃ§Ãµes RÃ¡pidas:**
- ğŸ‘ï¸ Ver detalhes
- ğŸ’¬ Responder
- ğŸ“Œ Fixar evento
- ğŸ”• Ignorar
- ğŸ“‹ Copiar info

**NotificaÃ§Ãµes:**
- ğŸ”” Som para eventos importantes
- ğŸ¨ Cores por tipo de evento
- ğŸ“± Badge no Ã­cone do navegador
- ğŸ’¬ NotificaÃ§Ã£o desktop (opcional)

#### ImplementaÃ§Ã£o:

**Backend:**
```javascript
// routes/events.js

// GET /api/events/stream - Stream de eventos
router.get('/stream', async (req, res) => {
  res.setHeader('Content-Type', 'text/event-stream');
  res.setHeader('Cache-Control', 'no-cache');
  res.setHeader('Connection', 'keep-alive');

  // Enviar eventos a cada 5 segundos
  const interval = setInterval(async () => {
    const events = await getRecentEvents();
    res.write(`data: ${JSON.stringify(events)}\n\n`);
  }, 5000);

  req.on('close', () => {
    clearInterval(interval);
  });
});

async function getRecentEvents() {
  // Ãšltimas mensagens
  const messages = await query(`
    SELECT 'message' as type, user_id, content, timestamp
    FROM n8n_chat
    WHERE timestamp > NOW() - INTERVAL '5 minutes'
    ORDER BY timestamp DESC
  `);

  // Ãšltimas anÃ¡lises
  const analyses = await query(`
    SELECT 'analysis' as type, user_id, product_name, score, created_at
    FROM daily_analyses
    WHERE created_at > NOW() - INTERVAL '5 minutes'
    ORDER BY created_at DESC
  `);

  // Alertas ativos
  const alerts = await query(`
    SELECT 'alert' as type, user_id, alert_type, created_at
    FROM alerts
    WHERE created_at > NOW() - INTERVAL '5 minutes'
    ORDER BY created_at DESC
  `);

  return [...messages, ...analyses, ...alerts]
    .sort((a, b) => b.timestamp - a.timestamp);
}
```

**Frontend:**
```jsx
// components/EventsFeed.jsx
export default function EventsFeed() {
  const [events, setEvents] = useState([]);
  const [filter, setFilter] = useState('all');

  useEffect(() => {
    const eventSource = new EventSource('/api/events/stream');
    
    eventSource.onmessage = (event) => {
      const newEvents = JSON.parse(event.data);
      setEvents(prev => [...newEvents, ...prev].slice(0, 50));
      
      // NotificaÃ§Ã£o sonora para eventos importantes
      if (newEvents.some(e => e.type === 'alert')) {
        playNotificationSound();
      }
    };

    return () => eventSource.close();
  }, []);

  const filteredEvents = events.filter(e => 
    filter === 'all' || e.type === filter
  );

  return (
    <div className="space-y-4">
      {/* Filtros */}
      <EventFilters filter={filter} onChange={setFilter} />
      
      {/* Feed */}
      <div className="space-y-3">
        {filteredEvents.map((event, i) => (
          <EventCard key={i} event={event} />
        ))}
      </div>
    </div>
  );
}
```

---

### 3. ğŸ¨ Outras Melhorias Planejadas

#### Dashboard Principal
- [ ] GrÃ¡fico de conversÃ£o (funil)
- [ ] Mapa de calor de atividade
- [ ] ComparaÃ§Ã£o mÃªs a mÃªs
- [ ] PrevisÃ£o de receita

#### UsuÃ¡rios
- [ ] SegmentaÃ§Ã£o automÃ¡tica
- [ ] Tags personalizadas
- [ ] Notas internas
- [ ] HistÃ³rico de aÃ§Ãµes

#### Analytics
- [ ] Cohort analysis
- [ ] Retention rate
- [ ] LTV (Lifetime Value)
- [ ] CAC (Custo de AquisiÃ§Ã£o)

#### AutomaÃ§Ãµes
- [ ] Criar follow-ups automÃ¡ticos
- [ ] A/B testing de mensagens
- [ ] Regras de engajamento
- [ ] Webhooks customizados

#### Social Media
- [ ] Aba de posts do Instagram
- [ ] Performance de conteÃºdo
- [ ] Agendamento de posts
- [ ] SugestÃµes de conteÃºdo pela IA

---

## ğŸ¯ PriorizaÃ§Ã£o

### Fase 1 (PrÃ³xima) - Conversas e Eventos
1. âœ… Interface de conversas espelhadas
2. âœ… Feed de eventos em tempo real
3. âœ… WebSocket para updates instantÃ¢neos

### Fase 2 - Analytics AvanÃ§ado
1. Funil de conversÃ£o
2. Cohort analysis
3. PrevisÃ£o de receita

### Fase 3 - AutomaÃ§Ãµes
1. Follow-ups automÃ¡ticos
2. A/B testing
3. Regras de engajamento

### Fase 4 - Social Media
1. Aba de Instagram
2. Performance de posts
3. Agendamento

---

## ğŸ’¡ Quer que eu implemente?

Posso comeÃ§ar por:

**OpÃ§Ã£o A:** Interface de Conversas Espelhadas (WhatsApp Web style)
**OpÃ§Ã£o B:** Feed de Eventos em Tempo Real
**OpÃ§Ã£o C:** Ambos ao mesmo tempo

Me diz qual vocÃª prefere e eu comeÃ§o agora! ğŸš€
